<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Working with data - Part 2 – BIOL90042 R Course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_4.html" rel="next">
<link href="./chapter_2.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-a9d6f1d2d70ec6daa267fded9d257be0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6402c674ead77b5518d08be0543df564.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/alpine-3.12/buttons.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter_3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Working with data - Part 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./WEHI_RGB_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">BIOL90042 R Course Book</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Working with data - Part 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Working with data - Part 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plotting with ggplot2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Putting it all together</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stats_primer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistics in R Primer</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">RNA-seq - Part 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">RNA-seq - Part 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8 Machine learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch8_section_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch8_section_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch8_section_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./further_reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Further reading</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In this chapter:</h2>
   
  <ul>
  <li><a href="#sec-mutate" id="toc-sec-mutate" class="nav-link active" data-scroll-target="#sec-mutate"><span class="header-section-number">3.1</span> Modifying data</a></li>
  <li><a href="#sec-summarise" id="toc-sec-summarise" class="nav-link" data-scroll-target="#sec-summarise"><span class="header-section-number">3.2</span> Summarising data</a></li>
  <li><a href="#sec-grouping" id="toc-sec-grouping" class="nav-link" data-scroll-target="#sec-grouping"><span class="header-section-number">3.3</span> Grouping</a></li>
  <li><a href="#sec-saving" id="toc-sec-saving" class="nav-link" data-scroll-target="#sec-saving"><span class="header-section-number">3.4</span> Saving data to a file</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">3.5</span> Summary</a>
  <ul class="collapse">
  <li><a href="#practice-questions" id="toc-practice-questions" class="nav-link" data-scroll-target="#practice-questions"><span class="header-section-number">3.5.1</span> Practice questions</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-chapter03" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Working with data - Part 2</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter we will continue learning how to manipulate and summarise data using the <code>dplyr</code> package (with a little help from the <code>tidyr</code> package too).</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>At the end of this chapter, learners should be able to:</p>
<ol type="1">
<li><p>Apply grouping for more complex analysis of data</p></li>
<li><p>Save data frames to a file</p></li>
</ol>
</div>
</div>
<p>Let’s first load the tidyverse</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…and read in the MouseZempic® dosage data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data, like we did in chapter 1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>m_dose <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/mousezempic_dosage_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 344 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): mouse_strain, cage_number, replicate, sex
dbl (5): weight_lost_g, drug_dose_g, tail_length_mm, initial_weight_g, id_num

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<section id="sec-mutate" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-mutate"><span class="header-section-number">3.1</span> Modifying data</h2>
<p>So far, we’ve learned how to filter rows and select columns from a data frame. But what if we want to change the data itself? This is where the <code>mutate()</code> function comes in.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/S02F07_mutate.png" class="img-fluid figure-img"></p>
<figcaption>Mutate allows you to add new columns to a data frame</figcaption>
</figure>
</div>
<p>The <code>mutate()</code> function is used to add new columns to a data frame, or modify existing columns, often by performing some sort of calculation. For example, we can add a new column to <code>m_dose</code> that contains the drug dose in mg (rather than g):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a new column called drug_dose_mg</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert drug_dose_g to mg by multiplying by 1000</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">drug_dose_mg =</span> drug_dose_g <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># just select the drug dose columns so we can compare them</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(drug_dose_g, drug_dose_mg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 2
   drug_dose_g drug_dose_mg
         &lt;dbl&gt;        &lt;dbl&gt;
 1     0.00181         1.81
 2     0.00186         1.86
 3     0.00195         1.95
 4    NA              NA   
 5     0.00193         1.93
 6     0.0019          1.9 
 7     0.00181         1.81
 8     0.00195         1.95
 9     0.00193         1.93
10     0.0019          1.9 
# ℹ 334 more rows</code></pre>
</div>
</div>
<p>You can see that the <code>drug_dose_mg</code> column has been added to the data frame, and it contains, for each row, the value of the <code>drug_dose_g</code> column multiplied by 1000 (<code>NA</code> values are preserved).</p>
<p>These calculations can be as complex as you like, and involve multiple different columns. For example, to add a new column to the <code>m_dose</code> data frame that calculates the weight lost as a percentage of the initial weight:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the % of initial weight that was lost</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_percent =</span> (weight_lost_g <span class="sc">/</span> initial_weight_g) <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 10
   mouse_strain cage_number weight_lost_g replicate sex    drug_dose_g
   &lt;chr&gt;        &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
 1 CD-1         1A                   3.75 rep1      male       0.00181
 2 CD-1         1A                   3.8  rep1      female     0.00186
 3 CD-1         1A                   3.25 rep1      female     0.00195
 4 CD-1         1A                  NA    rep1      &lt;NA&gt;      NA      
 5 CD-1         1A                   3.45 rep1      female     0.00193
 6 CD-1         1A                   3.65 rep1      male       0.0019 
 7 CD-1         1A                   3.62 rep1      female     0.00181
 8 CD-1         1A                   4.68 rep1      male       0.00195
 9 CD-1         1A                   3.48 rep1      &lt;NA&gt;       0.00193
10 CD-1         1A                   4.25 rep1      &lt;NA&gt;       0.0019 
# ℹ 334 more rows
# ℹ 4 more variables: tail_length_mm &lt;dbl&gt;, initial_weight_g &lt;dbl&gt;,
#   id_num &lt;dbl&gt;, weight_lost_percent &lt;dbl&gt;</code></pre>
</div>
</div>
<p>A useful helper function for <code>mutate()</code> is the <code>case_when()</code> function, which allows you to create new columns based on multiple conditions. We do this with the notation <code>case_when(condition1 ~ value1, condition2 ~ value2, ...)</code>.</p>
<p>For example, to add a new column to the <code>m_dose</code> data frame that categorises the mice based on how much weight they lost:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column called weight_loss_category</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_loss_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Low"</span>, <span class="co"># separate conditions with a comma</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"High"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weight_lost_g, weight_loss_category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 2
   weight_lost_g weight_loss_category
           &lt;dbl&gt; &lt;chr&gt;               
 1          3.75 Low                 
 2          3.8  Low                 
 3          3.25 Low                 
 4         NA    &lt;NA&gt;                
 5          3.45 Low                 
 6          3.65 Low                 
 7          3.62 Low                 
 8          4.68 Medium              
 9          3.48 Low                 
10          4.25 Medium              
# ℹ 334 more rows</code></pre>
</div>
</div>
<p>Note that the conditions are evaluated in order, and the first condition that is <code>TRUE</code> is the one that is used. So if a mouse lost 4.5g, it <code>case_when()</code> would first test if it fits the ‘Low’ category (by checking if 4.5 is less than 4, which it isn’t), and then if it fits the ‘Medium’ category (by checking if 4.5 is less than or equal to 5). Since it is, the mouse would be categorised as ‘Medium’.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Fallback with default value(s)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fallback with default value(s)
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the above example, what would happen if a mouse lost -1g (gained weight)? It wouldn’t fit any of the conditions, so it would get an <code>NA</code> in the <code>weight_loss_category</code> column. Sometimes you might want this behaviour, but other times you would prefer to specify a ‘fallback’ category that will be assigned to everything that doesn’t fit in the other categories. You can do this by including a <code>.default =</code> argument at the end of the <code>case_when()</code> function. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column called weight_loss_category</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_loss_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Low"</span>, <span class="co"># separate conditions with a comma</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"Unknown"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weight_lost_g, weight_loss_category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 2
   weight_lost_g weight_loss_category
           &lt;dbl&gt; &lt;chr&gt;               
 1          3.75 Low                 
 2          3.8  Low                 
 3          3.25 Low                 
 4         NA    Unknown             
 5          3.45 Low                 
 6          3.65 Low                 
 7          3.62 Low                 
 8          4.68 Medium              
 9          3.48 Low                 
10          4.25 Medium              
# ℹ 334 more rows</code></pre>
</div>
</div>
<p>Notice how the <code>NA</code> value in the fourth row is now categorised as ‘Unknown’.</p>
</div>
</div>
<p>One final thing to note is that <code>mutate()</code> can be used to modify existing columns as well as add new ones. To do this, just use the name of the existing column as the ‘new’ one.</p>
<p>For example, let’s use <code>mutate()</code> together with <code>case_when()</code> to modify the <code>sex</code> column so that it uses <code>M</code> and <code>F</code> instead <code>male</code> and <code>female</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modify sex column</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">~</span> <span class="st">"F"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">~</span> <span class="st">"M"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if neither, code it as 'X'</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"X"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 9
   mouse_strain cage_number weight_lost_g replicate sex   drug_dose_g
   &lt;chr&gt;        &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
 1 CD-1         1A                   3.75 rep1      M         0.00181
 2 CD-1         1A                   3.8  rep1      F         0.00186
 3 CD-1         1A                   3.25 rep1      F         0.00195
 4 CD-1         1A                  NA    rep1      X        NA      
 5 CD-1         1A                   3.45 rep1      F         0.00193
 6 CD-1         1A                   3.65 rep1      M         0.0019 
 7 CD-1         1A                   3.62 rep1      F         0.00181
 8 CD-1         1A                   4.68 rep1      M         0.00195
 9 CD-1         1A                   3.48 rep1      X         0.00193
10 CD-1         1A                   4.25 rep1      X         0.0019 
# ℹ 334 more rows
# ℹ 3 more variables: tail_length_mm &lt;dbl&gt;, initial_weight_g &lt;dbl&gt;,
#   id_num &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Practice exercises">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice exercises
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try these practice questions to test your understanding</p>
<div class="question">
<p>1. What line of code would you use to add a new column to the <code>m_dose</code> data frame that converts the <code>tail_length_mm</code> column to cm?</p>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% create(tail_length_cm = tail_length_mm / 10)</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no2"> <span id="no2" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% mutate(tail_length_cm == tail_length_mm / 10)</code></p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span><code>m_dose %&gt;% mutate(tail_length_cm = tail_length_mm / 10)</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no4"> <span id="no4" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% tail_length_cm = tail_length_mm / 10</code></p><p></p>
</div>
</div>

</div>
</div>
<div class="question">
<p>2. Explain in words what the following code does:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight_lost_g)) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_rank =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hint: the row_number() function returns the number of each row in the data frame (1 being the first row and so on).</p>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span>Adds a new column to the data frame that ranks the mice based on how much weight they lost, with 1 being the mouse that lost the least weight.</p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span>Adds a new column to the data frame that ranks the mice based on how much weight they lost, with 1 being the mouse that lost the most weight.</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span>Adds a new column to the data frame that ranks the mice</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no4"> <span id="no4" x-show="answer == $el.id" class="badge">✗</span>Does nothing, because the <code>row_number()</code> function has no arguments</p><p></p>
</div>
</div>

</div>
</div>
<div class="question">
<p>3. What is wrong with this R code?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Low"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Medium"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"High"</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in parse(text = input): &lt;text&gt;:4:5: unexpected symbol
3:     weight_lost_g &lt; 4 ~ "Low"
4:     weight_lost_g
       ^</code></pre>
</div>
</div>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span>You didn’t include a <code>.default =</code> condition at the end of the <code>case_when()</code> function to act as a fallback</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no2"> <span id="no2" x-show="answer == $el.id" class="badge">✗</span>You can’t use the <code>case_when()</code> function with the <code>mutate()</code> function</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span><code>weight_lost_g</code> is not a valid column name</p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span>You need to separate the conditions in the <code>case_when()</code> function with a comma</p><p></p>
</div>
</div>

</div>
</div>
<div class="question">
<p>4. Explain in words what the following code does:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mouse_strain =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    mouse_strain <span class="sc">==</span> <span class="st">"Black 6"</span> <span class="sc">~</span> <span class="st">"B6"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> mouse_strain</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hint: if you’re not sure, try running the code, but pipe it into <code>View()</code> so that you can take a good look at what’s happening in the <code>mouse_strain</code> column.</p>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span>Renames the strains of all the mice to “B6”, regardless of their original strain</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no2"> <span id="no2" x-show="answer == $el.id" class="badge">✗</span>This code will produce an error</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span>Adds a new column that categorises the mice based on their strain, so that any mice from the “Black 6” strain are now called “B6”, and all other strains are left unchanged.</p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span>Modifies the <code>mouse_strain</code> column so that any mice from the “Black 6” strain are now called “B6”, and all other strains are left unchanged.</p><p></p>
</div>
</div>

</div>
</div>
<details>
<summary>
Solutions
</summary>
<p>
</p><ol type="1">
<li>The correct line of code to add a new column to the <code>m_dose</code> data frame that converts the <code>tail_length_mm</code> column to cm is <code>m_dose %&gt;% mutate(tail_length_cm = tail_length_mm / 10)</code>.</li>
<li>The code <code>m_dose %&gt;% arrange(desc(weight_lost_g)) %&gt;% mutate(weight_lost_rank = row_number())</code> adds a new column to the data frame that ranks the mice based on how much weight they lost, with 1 being the mouse that lost the most weight. First, the <code>arrange(desc(weight_lost_g))</code> function sorts the data frame by the <code>weight_lost_g</code> column in descending order, and then the <code>mutate(weight_lost_rank = row_number())</code> function adds a new column that assigns a rank to each row based on its position (row number) in the sorted data frame.</li>
<li>The error is that the conditions in the <code>case_when()</code> function are not separated by commas. Each condition should be followed by a comma because these are like the arguments in a function. Remeber that it’s optional to include the <code>.default =</code> condition at the end of the <code>case_when()</code> function.</li>
<li>The code <code>m_dose %&gt;% mutate(mouse_strain = case_when(mouse_strain == "Black 6" ~ "B6", .default = mouse_strain))</code> modifies the <code>mouse_strain</code> column so that any mice from the “Black 6” strain are now called “B6”, and all other strains are left unchanged. As we are calling our column <code>mouse_strain</code>, no new column is being created (we are modifying the existing one) and the <code>.default = mouse_strain</code> condition acts as a fallback to keep the original values (that already exist in the <code>mouse_strain</code> column) for any rows that don’t match our first condition (strain being “Black 6”).</li>
</ol>
<p></p>
</details>
</div>
</div>
</section>
<section id="sec-summarise" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-summarise"><span class="header-section-number">3.2</span> Summarising data</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/S02F08_summarise.png" class="img-fluid figure-img"></p>
<figcaption>Summarise allows you to calculate summary statistics that collapse many rows into one</figcaption>
</figure>
</div>
<p>The <code>summarise()</code> (or <code>summarize()</code>, if you prefer US spelling) function is used to calculate summary statistics on your data. It takes similar arguments to <code>mutate()</code>, but instead of adding a new column to the data frame, it returns a new data frame with a single row and one column for each summary statistic you calculate.</p>
<p>For example, to calculate the mean weight lost by the mice in the <code>m_dose</code> data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  mean_weight_lost
             &lt;dbl&gt;
1             4.20</code></pre>
</div>
</div>
<p>We can also calculate multiple summary statistics at once. For example, to calculate the mean, median, and standard deviation of the weight lost by the mice:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  mean_weight_lost median_weight_lost sd_weight_lost
             &lt;dbl&gt;              &lt;dbl&gt;          &lt;dbl&gt;
1             4.20               4.05          0.802</code></pre>
</div>
</div>
<p>The power of summarising data is really seen when combined with grouping, which we will cover in the next section.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Practice exercises">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice exercises
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try these practice questions to test your understanding</p>
<div class="question">
<p>1. Explain in words what the following code does:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">average_tail =</span> <span class="fu">mean</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_tail =</span> <span class="fu">min</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_tail =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span>Calculates the average, minimum, and maximum tail length of the mice in the <code>m_dose</code> data frame.</p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span>Produces a data frame containing one column for each of the average, minimum, and maximum tail length of the mice in the <code>m_dose</code> data frame.</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span>Finds the average tail length of the mice in the <code>m_dose</code> data frame.</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no4"> <span id="no4" x-show="answer == $el.id" class="badge">✗</span>Produces a vector containing the average, minimum, and maximum tail length of the mice in the <code>m_dose</code> data frame.</p><p></p>
</div>
</div>

</div>
</div>
<div class="question">
<p>2. What is NOT a valid way to calculate the mean weight lost by the mice in the <code>m_dose</code> data frame?</p>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarise(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE))</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no2"> <span id="no2" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% pull(weight_lost_g) %&gt;% mean(na.rm = TRUE)</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarize(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE))</code></p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span><code>m_dose %&gt;% mean(weight_lost_g, na.rm = TRUE)</code></p><p></p>
</div>
</div>

</div>
</div>
<details>
<summary>
Solutions
</summary>
<p>1. The code <strong>produces a data frame</strong> containing one column for each of the average, minimum, and maximum tail length of the mice in the <code>m_dose</code> data frame.</p>
<p>2. The line of code that is NOT a valid way to calculate the mean weight lost by the mice in the <code>m_dose</code> data frame is <code>m_dose %&gt;% mean(weight_lost_g, na.rm = TRUE)</code>. This line of code is incorrect because the <code>mean()</code> function is being used directly on the data frame, rather than within a <code>summarise()</code> function. The other options are valid ways to calculate the mean weight lost by the mice in the <code>m_dose</code> data frame (although note that the second option uses <code>pull()</code> to extract the <code>weight_lost_g</code> column as a vector before calculating the mean, so the mean value is stored in a vector rather than in a data frame).</p>
</details>
</div>
</div>
</section>
<section id="sec-grouping" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-grouping"><span class="header-section-number">3.3</span> Grouping</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/S02F09_grouped_summarise.png" class="img-fluid figure-img"></p>
<figcaption>Using summarise with the .by option allows you to create separate summaries for different ‘groups’ of data</figcaption>
</figure>
</div>
<p>Grouping is a powerful concept in in <code>dplyr</code> that allows you to perform operations on subsets of your data. For example, you might want to calculate the mean weight lost by mice in each cage, or find the mouse with the longest tail in each strain.</p>
<p>We can group data using the <code>.by</code> argument that exists in many dplyr functions, like <code>summarise()</code> and <code>mutate()</code>, and passing it the name(s) of column(s) to group by. For example, to calculate the mean weight lost by mice in each cage:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># don't forget it's .by, not by!</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  cage_number mean_weight_lost
  &lt;chr&gt;                  &lt;dbl&gt;
1 1A                      3.71
2 3E                      4.72
3 2B                      3.71</code></pre>
</div>
</div>
<p>Like when we first learned the summarise function above, we give our new column a name (<code>mean_weight_lost</code>), and then we assign its value to be the mean of the <code>weight_lost_g</code> column (with <code>NA</code>s removed). But this time, we also added the <code>.by</code> argument to specify the column we want to group by (<code>cage_number</code>, in this case). This will return a data frame with the mean weight lost by mice in each cage.</p>
<p>Grouping is a powerful tool for exploring your data and can help you identify patterns that might not be obvious when looking at the data as a whole. For example, notice how this grouped summary reveals that mice in cage 3E lost more weight than those in the other two cages.</p>
<p>It’s also possible to group by multiple columns by passing a vector of column names to the <code>.by</code> argument. For example, to calculate the mean weight lost by mice in each cage and strain:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group by both cage_number and mouse_strain</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(cage_number, mouse_strain))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  cage_number mouse_strain mean_weight_lost
  &lt;chr&gt;       &lt;chr&gt;                   &lt;dbl&gt;
1 1A          CD-1                     3.71
2 3E          CD-1                     3.71
3 2B          CD-1                     3.69
4 3E          Black 6                  5.08
5 2B          BALB C                   3.73</code></pre>
</div>
</div>
<p>Of course, <code>mean()</code> is not the only function that we can use within <code>summarise()</code>. We can use any function that takes a vector of values and returns a single value, like <code>median()</code>, <code>sd()</code>, or <code>max()</code>. We can also use multiple functions at once, by giving each column a name and specifying the function we want to use. In the following code we first drop NA values from the <code>weight_lost_g</code> column, to avoid repeating <code>na.rm = TRUE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_lost_g) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_weight_lost =</span> <span class="fu">max</span>(weight_lost_g),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_weight_lost =</span> <span class="fu">min</span>(weight_lost_g),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  cage_number     n mean_weight_lost median_weight_lost sd_weight_lost
  &lt;chr&gt;       &lt;int&gt;            &lt;dbl&gt;              &lt;dbl&gt;          &lt;dbl&gt;
1 1A             51             3.71               3.7           0.445
2 3E            167             4.72               4.78          0.783
3 2B            124             3.71               3.69          0.417
# ℹ 2 more variables: max_weight_lost &lt;dbl&gt;, min_weight_lost &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Here, we also used the <code>n()</code> function to calculate the number of mice in each cage. This is a special helper function that works within <code>summarise</code> to count the number of rows in each group.</p>
<div class="callout callout-style-default callout-note callout-titled" title="To `.by` or not to `.by`?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
To <code>.by</code> or not to <code>.by</code>?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the <code>dplyr</code> package, there are two ways to group data: using the <code>.by</code> argument within various functions (as we have covered so far), or using the <code>group_by()</code> function, then performing your operations and ungrouping with <code>ungroup()</code>.</p>
<p>For example, we’ve seen above how to calculate the mean weight lost by mice in each cage using the <code>.by</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> cage_number)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  cage_number mean_weight_lost
  &lt;chr&gt;                  &lt;dbl&gt;
1 1A                      3.71
2 3E                      4.72
3 2B                      3.71</code></pre>
</div>
</div>
<p>But we can also do the same using <code>group_by()</code> and <code>ungroup()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cage_number) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  cage_number mean_weight_lost
  &lt;chr&gt;                  &lt;dbl&gt;
1 1A                      3.71
2 2B                      3.71
3 3E                      4.72</code></pre>
</div>
</div>
<p>The two methods are equivalent, but using the <code>.by</code> argument within functions can be more concise and easier to read. Still, it’s good to be aware of <code>group_by()</code> and <code>ungroup()</code> as they are widely used, particularly in older code.</p>
</div>
</div>
<p>Although grouping is most often used with <code>summarise()</code>, it can be used with <code>dplyr</code> functions too. For example mutate() function can also be used with grouping to add new columns to the data frame based on group-specific calculations. Let’s say we wanted to calculate the Z-score (also known as the <a href="https://en.wikipedia.org/wiki/Standard_score">standard score</a>) to standardise the weight lost by each mouse within each strain.</p>
<p>As a reminder, the formula for calculating the Z-score is <span class="math inline">\(\frac{x - \mu}{\sigma}\)</span>, where <span class="math inline">\(x\)</span> is the value (in our case the <code>weight_lost_g</code> column), <span class="math inline">\(\mu\)</span> is the mean, and <span class="math inline">\(\sigma\)</span> is the standard deviation.</p>
<p>We can calculate this for each mouse in each strain using the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove NAs before calculating the mean and SD</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight_lost_g)) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_z =</span> (weight_lost_g <span class="sc">-</span> <span class="fu">mean</span>(weight_lost_g)) <span class="sc">/</span> <span class="fu">sd</span>(weight_lost_g), <span class="at">.by =</span> mouse_strain) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select the relevant columns</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mouse_strain, weight_lost_g, weight_lost_z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 342 × 3
   mouse_strain weight_lost_g weight_lost_z
   &lt;chr&gt;                &lt;dbl&gt;         &lt;dbl&gt;
 1 CD-1                  3.75         0.108
 2 CD-1                  3.8          0.217
 3 CD-1                  3.25        -0.983
 4 CD-1                  3.45        -0.547
 5 CD-1                  3.65        -0.110
 6 CD-1                  3.62        -0.165
 7 CD-1                  4.68         2.12 
 8 CD-1                  3.48        -0.492
 9 CD-1                  4.25         1.20 
10 CD-1                  3.3         -0.874
# ℹ 332 more rows</code></pre>
</div>
</div>
<p>Unlike when we used <code>.by</code> with <code>summarise()</code>, we still get the same number of rows as the original data frame, but now we have a new column <code>weight_lost_z</code> that contains the Z-score for each mouse within each strain. This could be useful for identifying outliers or comparing the weight lost by each mouse to the average for its strain.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Practice exercises">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice exercises
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try these practice questions to test your understanding</p>
<div class="question">
<p>1. Which line of code would you use to calculate the median tail length of mice belonging to each strain in the <code>m_dose</code> data frame?</p>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm), .by = mouse_strain)</code></p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span><code>m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm, na.rm = TRUE), .by = mouse_strain)</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm, na.rm = TRUE), by = mouse_strain)</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no4"> <span id="no4" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% mutate(median_tail_length = median(tail_length_mm, na.rm = TRUE), .by = mouse_strain)</code></p><p></p>
</div>
</div>

</div>
</div>
<div class="question">
<p>2. Explain in words what the following code does:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_len =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(mouse_strain, replicate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span>Calculates the maximum tail length of all mice for each strain in the <code>m_dose</code> data frame</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no2"> <span id="no2" x-show="answer == $el.id" class="badge">✗</span>Calculates the maximum tail length of all mice for each replicate in the <code>m_dose</code> data frame</p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span>Calculates the maximum tail length of all mice in the <code>m_dose</code> data frame</p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span>Calculates the maximum tail length of mice in each unique combination of strain and replicate in the <code>m_dose</code> data frame.</p><p></p>
</div>
</div>

</div>
</div>
<div class="question">
<p>3. I want to count how many male and how many female mice there are for each strain in the <code>m_dose</code> data frame. Which line of code would I use?</p>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarise(count = n(), .by = sex)</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no2"> <span id="no2" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarise(count = n(), .by = mouse_strain)</code></p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span><code>m_dose %&gt;% summarise(count = n(), .by = c(mouse_strain, sex))</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no4"> <span id="no4" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarise(count = n(), .by = mouse_strain, sex)</code></p><p></p>
</div>
</div>

</div>
</div>
<div class="question">
<p>4. I want to find the proportion of weight lost <strong>by each mouse</strong> in each cage in the <code>m_dose</code> data frame. Which line of code would I use?</p>
<div class="choices">
<div x-data="{ answer: '' , clear() { this.answer = '' }}">

<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no1"> <span id="no1" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% summarise(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE), .by = cage_number)</code></p><p></p>
</div>
<div class="choice correct-choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="correct"> <span id="correct" x-show="answer == $el.id" class="badge">✔</span><code>m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE), .by = cage_number)</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no3"> <span id="no3" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE, .by = cage_number))</code></p><p></p>
</div>
<div class="choice">
<p></p><p><input class="form-check-input" type="radio" x-model="answer" value="no4"> <span id="no4" x-show="answer == $el.id" class="badge">✗</span><code>m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE))</code></p><p></p>
</div>
</div>

</div>
</div>
<details>
<summary>
Solutions
</summary>
<p>
</p><ol type="1">
<li>The correct line of code to calculate the median tail length of mice belonging to each strain in the <code>m_dose</code> data frame is <code>m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm, na.rm = TRUE), .by = mouse_strain)</code>. Remember to use <code>na.rm = TRUE</code> to remove any missing values before calculating the median, and to use <code>.by</code> to specify the column to group by (not <code>by</code>). Seeing as we want to calculate the median (collapse down to a single value per group), we need to use <code>summarise()</code> rather than <code>mutate()</code>.</li>
<li>The code <code>m_dose %&gt;% summarise(max_tail_len = max(tail_length_mm, na.rm = TRUE), .by = c(mouse_strain, replicate))</code> calculates the maximum tail length of mice in each <strong>unique combination</strong> of strain and replicate in the <code>m_dose</code> data frame.</li>
<li>The correct line of code to count how many male and how many female mice there are for each strain in the <code>m_dose</code> data frame is <code>m_dose %&gt;% summarise(count = n(), .by = c(mouse_strain, sex))</code>. We need to group by both <code>mouse_strain</code> and <code>sex</code> to get the count for each unique combination of strain and sex. Don’t forget that we specify the column names as a vector when grouping by multiple columns.</li>
<li>The correct line of code to find the proportion of weight lost <strong>by each mouse</strong> in each cage in the <code>m_dose</code> data frame is <code>m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE), .by = cage_number)</code>. We use <code>mutate()</code> because we want a value for each mouse (each row in our data), rather than to collapse down to a single value for each group (cage number in this case). Be careful that you use the <code>.by</code> argument within the <code>mutate()</code> function call, not within the <code>sum()</code> function by mistake (this is what is wrong with the third option).</li>
</ol>
<p></p>
</details>
</div>
</div>
</section>
<section id="sec-saving" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-saving"><span class="header-section-number">3.4</span> Saving data to a file</h2>
<p>Once you’ve cleaned and transformed your data, you’ll often want to save it to a file so that you can use it in other programs or share it with others. The <code>write_csv()</code> and <code>write_tsv()</code> functions from the <code>readr</code> package are a great way to do this. They take two arguments - the data frame you want to save and the file path where you want to save it.</p>
<p>For example, let’s say I want to save my summary table of the weight lost by mice in each cage to a CSV file called <code>cage_summary_table.csv</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the summary table</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and assign it to a variable</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>cage_summary_table <span class="ot">&lt;-</span> m_dose <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># save the data to a CSV file</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(cage_summary_table, <span class="st">"cage_summary_table.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>CSV files are particularly great because they can be easily read into other software, like Excel.</p>
<p>It’s also possible to use the <code>write_*()</code> functions along with a pipe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_lost_g) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">"cage_summary_table.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember here that the first argument (the data frame to save) is passed on by the pipe, so the only argument in the brackets is the second one: the file path.</p>
</section>
<section id="summary" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="summary"><span class="header-section-number">3.5</span> Summary</h2>
<p>Here’s what we’ve covered in this chapter:</p>
<ul>
<li><p>The basic dplyr verbs <code>mutate()</code>, and <code>arrange()</code> and how they can be used to tidy and analyse data.</p></li>
<li><p>The <code>summarise()</code> function and how it can be used to calculate summary statistics on your data, as well as the power of grouping data with the <code>.by</code> argument.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Why does data need to be tidy anyway?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why does data need to be tidy anyway?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this chapter, we’ve been focusing on making our data ‘tidy’: that is, structured in a consistent way that makes it easy to work with. A nice visual illustration of tidy data and its importance can be <a href="https://allisonhorst.com/other-r-fun">found here</a>.</p>
</div>
</div>
<section id="practice-questions" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="practice-questions"><span class="header-section-number">3.5.1</span> Practice questions</h3>
<ol type="1">
<li><p>What would be the result of evaluating the following expressions? You don’t need to know these off the top of your head, use R to help! (Hint: some expressions might give an error. Try to think about why)</p>
<ol type="a">
<li><code>m_dose %&gt;% mutate(weight_lost_kg = weight_lost_g / 1000)</code></li>
<li><code>m_dose %&gt;% summarise(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE))</code></li>
<li><code>m_dose %&gt;% summarise(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE), .by = cage_number)</code></li>
</ol></li>
<li><p>I want to add a new column to the <code>m_dose</code> data frame that converts the <code>mouse_strain</code> column to lowercase. Hint: you can use the <code>tolower()</code> function in R to convert characters to lowercase. Look up its help page by typing <code>?tolower</code> in the R console to see how to use it.</p></li>
<li><p>How could you find the maximum tail length for each unique combination of sex and mouse strain in the <code>m_dose</code> data frame?</p></li>
<li><p>Write a line of code to save the result of Q5 to a CSV file called <code>max_tail_length.csv</code>.</p></li>
</ol>
<details>
<summary>
Solutions
</summary>
<ol type="1">
<li>The result of evaluating the expressions would be:
<ol type="a">
<li>A data frame with an additional column <code>weight_lost_kg</code> that contains the weight lost in kilograms.</li>
<li>A data frame with the mean weight lost by all mice.</li>
<li>A data frame with the mean weight lost by mice in each cage.</li>
</ol></li>
<li>To add a new column to the <code>m_dose</code> data frame that converts the <code>mouse_strain</code> column to lowercase, you can use <code>mutate()</code> as follows`:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mouse_strain_lower =</span> <span class="fu">tolower</span>(mouse_strain))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 10
   mouse_strain cage_number weight_lost_g replicate sex    drug_dose_g
   &lt;chr&gt;        &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
 1 CD-1         1A                   3.75 rep1      male       0.00181
 2 CD-1         1A                   3.8  rep1      female     0.00186
 3 CD-1         1A                   3.25 rep1      female     0.00195
 4 CD-1         1A                  NA    rep1      &lt;NA&gt;      NA      
 5 CD-1         1A                   3.45 rep1      female     0.00193
 6 CD-1         1A                   3.65 rep1      male       0.0019 
 7 CD-1         1A                   3.62 rep1      female     0.00181
 8 CD-1         1A                   4.68 rep1      male       0.00195
 9 CD-1         1A                   3.48 rep1      &lt;NA&gt;       0.00193
10 CD-1         1A                   4.25 rep1      &lt;NA&gt;       0.0019 
# ℹ 334 more rows
# ℹ 4 more variables: tail_length_mm &lt;dbl&gt;, initial_weight_g &lt;dbl&gt;,
#   id_num &lt;dbl&gt;, mouse_strain_lower &lt;chr&gt;</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>You can use the <code>max()</code> function within <code>summarise(.by = c(sex, mouse_strain))</code> to find the maximum tail length of each unique sex/mouse strain combination:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_length =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(sex, mouse_strain))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  sex    mouse_strain max_tail_length
  &lt;chr&gt;  &lt;chr&gt;                  &lt;dbl&gt;
1 male   CD-1                    21.5
2 female CD-1                    20.7
3 &lt;NA&gt;   CD-1                    20.2
4 female Black 6                 15.5
5 male   Black 6                 17.3
6 &lt;NA&gt;   Black 6                 15.7
7 female BALB C                  19.4
8 male   BALB C                  20.8</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>To save the result of Q5 to a CSV file called <code>max_tail_length.csv</code>, you can use the <code>write_csv()</code> function, either by using a pipe to connect it to the code you wrote previously:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_length =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(sex, mouse_strain)) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">"max_tail_length.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or by assigning this result to a variable and then saving it to a file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>max_tail_length <span class="ot">&lt;-</span> m_dose <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_length =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(sex, mouse_strain))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(max_tail_length, <span class="st">"max_tail_length.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_2.html" class="pagination-link" aria-label="Working with data - Part 1">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Working with data - Part 1</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter_4.html" class="pagination-link" aria-label="Plotting with ggplot2">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Plotting with ggplot2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb44" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - naquiz</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "In this chapter:"</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># Working with data - Part 2 {#sec-chapter03}</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>In this chapter we will continue learning how to manipulate and summarise data using the <span class="in">`dplyr`</span> package (with a little help from the <span class="in">`tidyr`</span> package too).</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Learning Objectives"}</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>At the end of this chapter, learners should be able to:</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Apply grouping for more complex analysis of data</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Save data frames to a file</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>Let's first load the tidyverse</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>...and read in the MouseZempic® dosage data</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data, like we did in chapter 1</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>m_dose <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/mousezempic_dosage_data.csv"</span>)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="co"># just for rendering the book not for students to see</span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>m_dose <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/mousezempic_dosage_data.csv"</span>)</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modifying data {#sec-mutate}</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>So far, we've learned how to filter rows and select columns from a data frame. But what if we want to change the data itself? This is where the <span class="in">`mutate()`</span> function comes in.</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a><span class="al">![Mutate allows you to add new columns to a data frame](images/S02F07_mutate.png)</span></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>The <span class="in">`mutate()`</span> function is used to add new columns to a data frame, or modify existing columns, often by performing some sort of calculation. For example, we can add a new column to <span class="in">`m_dose`</span> that contains the drug dose in mg (rather than g):</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a new column called drug_dose_mg</span></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert drug_dose_g to mg by multiplying by 1000</span></span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">drug_dose_mg =</span> drug_dose_g <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># just select the drug dose columns so we can compare them</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(drug_dose_g, drug_dose_mg)</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>You can see that the <span class="in">`drug_dose_mg`</span> column has been added to the data frame, and it contains, for each row, the value of the <span class="in">`drug_dose_g`</span> column multiplied by 1000 (<span class="in">`NA`</span> values are preserved).</span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>These calculations can be as complex as you like, and involve multiple different columns. For example, to add a new column to the <span class="in">`m_dose`</span> data frame that calculates the weight lost as a percentage of the initial weight:</span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the % of initial weight that was lost</span></span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_percent =</span> (weight_lost_g <span class="sc">/</span> initial_weight_g) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>A useful helper function for <span class="in">`mutate()`</span> is the <span class="in">`case_when()`</span> function, which allows you to create new columns based on multiple conditions. We do this with the notation <span class="in">`case_when(condition1 ~ value1, condition2 ~ value2, ...)`</span>.</span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>For example, to add a new column to the <span class="in">`m_dose`</span> data frame that categorises the mice based on how much weight they lost:</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column called weight_loss_category</span></span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_loss_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Low"</span>, <span class="co"># separate conditions with a comma</span></span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"High"</span></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weight_lost_g, weight_loss_category)</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a>Note that the conditions are evaluated in order, and the first condition that is <span class="in">`TRUE`</span> is the one that is used. So if a mouse lost 4.5g, it <span class="in">`case_when()`</span> would first test if it fits the 'Low' category (by checking if 4.5 is less than 4, which it isn't), and then if it fits the 'Medium' category (by checking if 4.5 is less than or equal to 5). Since it is, the mouse would be categorised as 'Medium'.</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Fallback with default value(s)"}</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a>In the above example, what would happen if a mouse lost -1g (gained weight)? It wouldn't fit any of the conditions, so it would get an <span class="in">`NA`</span> in the <span class="in">`weight_loss_category`</span> column. Sometimes you might want this behaviour, but other times you would prefer to specify a 'fallback' category that will be assigned to everything that doesn't fit in the other categories. You can do this by including a <span class="in">` .default = `</span> argument at the end of the <span class="in">`case_when()`</span> function. For example:</span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column called weight_loss_category</span></span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_loss_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Low"</span>, <span class="co"># separate conditions with a comma</span></span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"Unknown"</span></span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(weight_lost_g, weight_loss_category)</span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a>Notice how the <span class="in">`NA`</span> value in the fourth row is now categorised as 'Unknown'.</span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a>One final thing to note is that <span class="in">`mutate()`</span> can be used to modify existing columns as well as add new ones. To do this, just use the name of the existing column as the 'new' one.</span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a>For example, let's use <span class="in">`mutate()`</span> together with <span class="in">`case_when()`</span> to modify the <span class="in">`sex`</span> column so that it uses <span class="in">`M`</span> and <span class="in">`F`</span> instead <span class="in">`male`</span> and <span class="in">`female`</span>:</span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modify sex column</span></span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">~</span> <span class="st">"F"</span>,</span>
<span id="cb44-132"><a href="#cb44-132" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">~</span> <span class="st">"M"</span>,</span>
<span id="cb44-133"><a href="#cb44-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if neither, code it as 'X'</span></span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"X"</span>))</span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="Practice exercises"}</span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true" tabindex="-1"></a>Try these practice questions to test your understanding</span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-141"><a href="#cb44-141" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\.</span> What line of code would you use to add a new column to the <span class="in">`m_dose`</span> data frame that converts the <span class="in">`tail_length_mm`</span> column to cm?</span>
<span id="cb44-142"><a href="#cb44-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-143"><a href="#cb44-143" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-144"><a href="#cb44-144" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-145"><a href="#cb44-145" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% create(tail_length_cm = tail_length_mm / 10)`</span></span>
<span id="cb44-146"><a href="#cb44-146" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-147"><a href="#cb44-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-148"><a href="#cb44-148" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-149"><a href="#cb44-149" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% mutate(tail_length_cm == tail_length_mm / 10)`</span></span>
<span id="cb44-150"><a href="#cb44-150" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-151"><a href="#cb44-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-152"><a href="#cb44-152" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-153"><a href="#cb44-153" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% mutate(tail_length_cm = tail_length_mm / 10)`</span></span>
<span id="cb44-154"><a href="#cb44-154" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-155"><a href="#cb44-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-156"><a href="#cb44-156" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-157"><a href="#cb44-157" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% tail_length_cm = tail_length_mm / 10`</span></span>
<span id="cb44-158"><a href="#cb44-158" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-159"><a href="#cb44-159" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-160"><a href="#cb44-160" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-161"><a href="#cb44-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-162"><a href="#cb44-162" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-163"><a href="#cb44-163" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\.</span> Explain in words what the following code does:</span>
<span id="cb44-164"><a href="#cb44-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-167"><a href="#cb44-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-168"><a href="#cb44-168" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-169"><a href="#cb44-169" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-170"><a href="#cb44-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight_lost_g)) <span class="sc">%&gt;%</span></span>
<span id="cb44-171"><a href="#cb44-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_rank =</span> <span class="fu">row_number</span>())</span>
<span id="cb44-172"><a href="#cb44-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-173"><a href="#cb44-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-174"><a href="#cb44-174" aria-hidden="true" tabindex="-1"></a>Hint: the row_number() function returns the number of each row in the data frame (1 being the first row and so on).</span>
<span id="cb44-175"><a href="#cb44-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-176"><a href="#cb44-176" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-177"><a href="#cb44-177" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-178"><a href="#cb44-178" aria-hidden="true" tabindex="-1"></a>Adds a new column to the data frame that ranks the mice based on how much weight they lost, with 1 being the mouse that lost the least weight.</span>
<span id="cb44-179"><a href="#cb44-179" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-180"><a href="#cb44-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-181"><a href="#cb44-181" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-182"><a href="#cb44-182" aria-hidden="true" tabindex="-1"></a>Adds a new column to the data frame that ranks the mice based on how much weight they lost, with 1 being the mouse that lost the most weight.</span>
<span id="cb44-183"><a href="#cb44-183" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-184"><a href="#cb44-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-185"><a href="#cb44-185" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-186"><a href="#cb44-186" aria-hidden="true" tabindex="-1"></a>Adds a new column to the data frame that ranks the mice</span>
<span id="cb44-187"><a href="#cb44-187" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-188"><a href="#cb44-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-189"><a href="#cb44-189" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-190"><a href="#cb44-190" aria-hidden="true" tabindex="-1"></a>Does nothing, because the <span class="in">`row_number()`</span> function has no arguments</span>
<span id="cb44-191"><a href="#cb44-191" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-192"><a href="#cb44-192" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-193"><a href="#cb44-193" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-194"><a href="#cb44-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-195"><a href="#cb44-195" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-196"><a href="#cb44-196" aria-hidden="true" tabindex="-1"></a>3<span class="sc">\.</span> What is wrong with this R code?</span>
<span id="cb44-197"><a href="#cb44-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-200"><a href="#cb44-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-201"><a href="#cb44-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb44-202"><a href="#cb44-202" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-203"><a href="#cb44-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-204"><a href="#cb44-204" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Low"</span></span>
<span id="cb44-205"><a href="#cb44-205" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Medium"</span></span>
<span id="cb44-206"><a href="#cb44-206" aria-hidden="true" tabindex="-1"></a>    weight_lost_g <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"High"</span></span>
<span id="cb44-207"><a href="#cb44-207" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb44-208"><a href="#cb44-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-209"><a href="#cb44-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-210"><a href="#cb44-210" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-211"><a href="#cb44-211" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-212"><a href="#cb44-212" aria-hidden="true" tabindex="-1"></a>You didn't include a <span class="in">`.default =`</span> condition at the end of the <span class="in">`case_when()`</span> function to act as a fallback</span>
<span id="cb44-213"><a href="#cb44-213" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-214"><a href="#cb44-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-215"><a href="#cb44-215" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-216"><a href="#cb44-216" aria-hidden="true" tabindex="-1"></a>You can't use the <span class="in">`case_when()`</span> function with the <span class="in">`mutate()`</span> function</span>
<span id="cb44-217"><a href="#cb44-217" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-218"><a href="#cb44-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-219"><a href="#cb44-219" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-220"><a href="#cb44-220" aria-hidden="true" tabindex="-1"></a><span class="in">`weight_lost_g`</span> is not a valid column name</span>
<span id="cb44-221"><a href="#cb44-221" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-222"><a href="#cb44-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-223"><a href="#cb44-223" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-224"><a href="#cb44-224" aria-hidden="true" tabindex="-1"></a>You need to separate the conditions in the <span class="in">`case_when()`</span> function with a comma</span>
<span id="cb44-225"><a href="#cb44-225" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-226"><a href="#cb44-226" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-227"><a href="#cb44-227" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-228"><a href="#cb44-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-229"><a href="#cb44-229" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-230"><a href="#cb44-230" aria-hidden="true" tabindex="-1"></a>4<span class="sc">\.</span> Explain in words what the following code does:</span>
<span id="cb44-231"><a href="#cb44-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-234"><a href="#cb44-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-235"><a href="#cb44-235" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-236"><a href="#cb44-236" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-237"><a href="#cb44-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mouse_strain =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-238"><a href="#cb44-238" aria-hidden="true" tabindex="-1"></a>    mouse_strain <span class="sc">==</span> <span class="st">"Black 6"</span> <span class="sc">~</span> <span class="st">"B6"</span>,</span>
<span id="cb44-239"><a href="#cb44-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> mouse_strain</span>
<span id="cb44-240"><a href="#cb44-240" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb44-241"><a href="#cb44-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-242"><a href="#cb44-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-243"><a href="#cb44-243" aria-hidden="true" tabindex="-1"></a>Hint: if you're not sure, try running the code, but pipe it into <span class="in">`View()`</span> so that you can take a good look at what's happening in the <span class="in">`mouse_strain`</span> column.</span>
<span id="cb44-244"><a href="#cb44-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-245"><a href="#cb44-245" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-246"><a href="#cb44-246" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-247"><a href="#cb44-247" aria-hidden="true" tabindex="-1"></a>Renames the strains of all the mice to "B6", regardless of their original strain</span>
<span id="cb44-248"><a href="#cb44-248" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-249"><a href="#cb44-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-250"><a href="#cb44-250" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-251"><a href="#cb44-251" aria-hidden="true" tabindex="-1"></a>This code will produce an error</span>
<span id="cb44-252"><a href="#cb44-252" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-253"><a href="#cb44-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-254"><a href="#cb44-254" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-255"><a href="#cb44-255" aria-hidden="true" tabindex="-1"></a>Adds a new column that categorises the mice based on their strain, so that any mice from the "Black 6" strain are now called "B6", and all other strains are left unchanged.</span>
<span id="cb44-256"><a href="#cb44-256" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-257"><a href="#cb44-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-258"><a href="#cb44-258" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-259"><a href="#cb44-259" aria-hidden="true" tabindex="-1"></a>Modifies the <span class="in">`mouse_strain`</span> column so that any mice from the "Black 6" strain are now called "B6", and all other strains are left unchanged.</span>
<span id="cb44-260"><a href="#cb44-260" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-261"><a href="#cb44-261" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-262"><a href="#cb44-262" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-263"><a href="#cb44-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-264"><a href="#cb44-264" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">details</span><span class="dt">&gt;</span></span>
<span id="cb44-265"><a href="#cb44-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-266"><a href="#cb44-266" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">summary</span><span class="dt">&gt;</span>Solutions<span class="dt">&lt;/</span><span class="kw">summary</span><span class="dt">&gt;</span></span>
<span id="cb44-267"><a href="#cb44-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-268"><a href="#cb44-268" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb44-269"><a href="#cb44-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-270"><a href="#cb44-270" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The correct line of code to add a new column to the <span class="in">`m_dose`</span> data frame that converts the <span class="in">`tail_length_mm`</span> column to cm is <span class="in">`m_dose %&gt;% mutate(tail_length_cm = tail_length_mm / 10)`</span>.</span>
<span id="cb44-271"><a href="#cb44-271" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The code <span class="in">`m_dose %&gt;% arrange(desc(weight_lost_g)) %&gt;% mutate(weight_lost_rank = row_number())`</span> adds a new column to the data frame that ranks the mice based on how much weight they lost, with 1 being the mouse that lost the most weight. First, the <span class="in">`arrange(desc(weight_lost_g))`</span> function sorts the data frame by the <span class="in">`weight_lost_g`</span> column in descending order, and then the <span class="in">`mutate(weight_lost_rank = row_number())`</span> function adds a new column that assigns a rank to each row based on its position (row number) in the sorted data frame.</span>
<span id="cb44-272"><a href="#cb44-272" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The error is that the conditions in the <span class="in">`case_when()`</span> function are not separated by commas. Each condition should be followed by a comma because these are like the arguments in a function. Remeber that it's optional to include the <span class="in">`.default =`</span> condition at the end of the <span class="in">`case_when()`</span> function.</span>
<span id="cb44-273"><a href="#cb44-273" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>The code <span class="in">`m_dose %&gt;% mutate(mouse_strain = case_when(mouse_strain == "Black 6" ~ "B6", .default = mouse_strain))`</span> modifies the <span class="in">`mouse_strain`</span> column so that any mice from the "Black 6" strain are now called "B6", and all other strains are left unchanged. As we are calling our column <span class="in">`mouse_strain`</span>, no new column is being created (we are modifying the existing one) and the <span class="in">`.default = mouse_strain`</span> condition acts as a fallback to keep the original values (that already exist in the <span class="in">`mouse_strain`</span> column) for any rows that don't match our first condition (strain being "Black 6").</span>
<span id="cb44-274"><a href="#cb44-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-275"><a href="#cb44-275" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb44-276"><a href="#cb44-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-277"><a href="#cb44-277" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">details</span><span class="dt">&gt;</span></span>
<span id="cb44-278"><a href="#cb44-278" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-279"><a href="#cb44-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-280"><a href="#cb44-280" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summarising data {#sec-summarise}</span></span>
<span id="cb44-281"><a href="#cb44-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-282"><a href="#cb44-282" aria-hidden="true" tabindex="-1"></a><span class="al">![Summarise allows you to calculate summary statistics that collapse many rows into one](images/S02F08_summarise.png)</span></span>
<span id="cb44-283"><a href="#cb44-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-284"><a href="#cb44-284" aria-hidden="true" tabindex="-1"></a>The <span class="in">`summarise()`</span> (or <span class="in">`summarize()`</span>, if you prefer US spelling) function is used to calculate summary statistics on your data. It takes similar arguments to <span class="in">`mutate()`</span>, but instead of adding a new column to the data frame, it returns a new data frame with a single row and one column for each summary statistic you calculate.</span>
<span id="cb44-285"><a href="#cb44-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-286"><a href="#cb44-286" aria-hidden="true" tabindex="-1"></a>For example, to calculate the mean weight lost by the mice in the <span class="in">`m_dose`</span> data frame:</span>
<span id="cb44-287"><a href="#cb44-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-290"><a href="#cb44-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-291"><a href="#cb44-291" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-292"><a href="#cb44-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb44-293"><a href="#cb44-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-294"><a href="#cb44-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-295"><a href="#cb44-295" aria-hidden="true" tabindex="-1"></a>We can also calculate multiple summary statistics at once. For example, to calculate the mean, median, and standard deviation of the weight lost by the mice:</span>
<span id="cb44-296"><a href="#cb44-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-299"><a href="#cb44-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-300"><a href="#cb44-300" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-301"><a href="#cb44-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-302"><a href="#cb44-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-303"><a href="#cb44-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-304"><a href="#cb44-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-305"><a href="#cb44-305" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-306"><a href="#cb44-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-307"><a href="#cb44-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-308"><a href="#cb44-308" aria-hidden="true" tabindex="-1"></a>The power of summarising data is really seen when combined with grouping, which we will cover in the next section.</span>
<span id="cb44-309"><a href="#cb44-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-310"><a href="#cb44-310" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="Practice exercises"}</span>
<span id="cb44-311"><a href="#cb44-311" aria-hidden="true" tabindex="-1"></a>Try these practice questions to test your understanding</span>
<span id="cb44-312"><a href="#cb44-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-313"><a href="#cb44-313" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-314"><a href="#cb44-314" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\.</span> Explain in words what the following code does:</span>
<span id="cb44-315"><a href="#cb44-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-318"><a href="#cb44-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-319"><a href="#cb44-319" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-320"><a href="#cb44-320" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-321"><a href="#cb44-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">average_tail =</span> <span class="fu">mean</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-322"><a href="#cb44-322" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_tail =</span> <span class="fu">min</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-323"><a href="#cb44-323" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_tail =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb44-324"><a href="#cb44-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-325"><a href="#cb44-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-326"><a href="#cb44-326" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-327"><a href="#cb44-327" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-328"><a href="#cb44-328" aria-hidden="true" tabindex="-1"></a>Calculates the average, minimum, and maximum tail length of the mice in the <span class="in">`m_dose`</span> data frame.</span>
<span id="cb44-329"><a href="#cb44-329" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-330"><a href="#cb44-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-331"><a href="#cb44-331" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-332"><a href="#cb44-332" aria-hidden="true" tabindex="-1"></a>Produces a data frame containing one column for each of the average, minimum, and maximum tail length of the mice in the <span class="in">`m_dose`</span> data frame.</span>
<span id="cb44-333"><a href="#cb44-333" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-334"><a href="#cb44-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-335"><a href="#cb44-335" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-336"><a href="#cb44-336" aria-hidden="true" tabindex="-1"></a>Finds the average tail length of the mice in the <span class="in">`m_dose`</span> data frame.</span>
<span id="cb44-337"><a href="#cb44-337" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-338"><a href="#cb44-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-339"><a href="#cb44-339" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-340"><a href="#cb44-340" aria-hidden="true" tabindex="-1"></a>Produces a vector containing the average, minimum, and maximum tail length of the mice in the <span class="in">`m_dose`</span> data frame.</span>
<span id="cb44-341"><a href="#cb44-341" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-342"><a href="#cb44-342" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-343"><a href="#cb44-343" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-344"><a href="#cb44-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-345"><a href="#cb44-345" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-346"><a href="#cb44-346" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\.</span> What is NOT a valid way to calculate the mean weight lost by the mice in the <span class="in">`m_dose`</span> data frame?</span>
<span id="cb44-347"><a href="#cb44-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-348"><a href="#cb44-348" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-349"><a href="#cb44-349" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-350"><a href="#cb44-350" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE))`</span></span>
<span id="cb44-351"><a href="#cb44-351" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-352"><a href="#cb44-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-353"><a href="#cb44-353" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-354"><a href="#cb44-354" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% pull(weight_lost_g) %&gt;% mean(na.rm = TRUE)`</span></span>
<span id="cb44-355"><a href="#cb44-355" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-356"><a href="#cb44-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-357"><a href="#cb44-357" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-358"><a href="#cb44-358" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarize(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE))`</span></span>
<span id="cb44-359"><a href="#cb44-359" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-360"><a href="#cb44-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-361"><a href="#cb44-361" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-362"><a href="#cb44-362" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% mean(weight_lost_g, na.rm = TRUE)`</span></span>
<span id="cb44-363"><a href="#cb44-363" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-364"><a href="#cb44-364" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-365"><a href="#cb44-365" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-366"><a href="#cb44-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-367"><a href="#cb44-367" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">details</span><span class="dt">&gt;</span></span>
<span id="cb44-368"><a href="#cb44-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-369"><a href="#cb44-369" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">summary</span><span class="dt">&gt;</span>Solutions<span class="dt">&lt;/</span><span class="kw">summary</span><span class="dt">&gt;</span></span>
<span id="cb44-370"><a href="#cb44-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-371"><a href="#cb44-371" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\.</span> The code **produces a data frame** containing one column for each of the average, minimum, and maximum tail length of the mice in the <span class="in">`m_dose`</span> data frame.</span>
<span id="cb44-372"><a href="#cb44-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-373"><a href="#cb44-373" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\.</span> The line of code that is NOT a valid way to calculate the mean weight lost by the mice in the <span class="in">`m_dose`</span> data frame is <span class="in">`m_dose %&gt;% mean(weight_lost_g, na.rm = TRUE)`</span>. This line of code is incorrect because the <span class="in">`mean()`</span> function is being used directly on the data frame, rather than within a <span class="in">`summarise()`</span> function. The other options are valid ways to calculate the mean weight lost by the mice in the <span class="in">`m_dose`</span> data frame (although note that the second option uses <span class="in">`pull()`</span> to extract the <span class="in">`weight_lost_g`</span> column as a vector before calculating the mean, so the mean value is stored in a vector rather than in a data frame).</span>
<span id="cb44-374"><a href="#cb44-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-375"><a href="#cb44-375" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">details</span><span class="dt">&gt;</span></span>
<span id="cb44-376"><a href="#cb44-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-377"><a href="#cb44-377" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-378"><a href="#cb44-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-379"><a href="#cb44-379" aria-hidden="true" tabindex="-1"></a><span class="fu">## Grouping {#sec-grouping}</span></span>
<span id="cb44-380"><a href="#cb44-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-381"><a href="#cb44-381" aria-hidden="true" tabindex="-1"></a><span class="al">![Using summarise with the .by option allows you to create separate summaries for different 'groups' of data](images/S02F09_grouped_summarise.png)</span></span>
<span id="cb44-382"><a href="#cb44-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-383"><a href="#cb44-383" aria-hidden="true" tabindex="-1"></a>Grouping is a powerful concept in in <span class="in">`dplyr`</span> that allows you to perform operations on subsets of your data. For example, you might want to calculate the mean weight lost by mice in each cage, or find the mouse with the longest tail in each strain.</span>
<span id="cb44-384"><a href="#cb44-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-385"><a href="#cb44-385" aria-hidden="true" tabindex="-1"></a>We can group data using the <span class="in">`.by`</span> argument that exists in many dplyr functions, like <span class="in">`summarise()`</span> and <span class="in">`mutate()`</span>, and passing it the name(s) of column(s) to group by. For example, to calculate the mean weight lost by mice in each cage:</span>
<span id="cb44-386"><a href="#cb44-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-389"><a href="#cb44-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-390"><a href="#cb44-390" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-391"><a href="#cb44-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-392"><a href="#cb44-392" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-393"><a href="#cb44-393" aria-hidden="true" tabindex="-1"></a>    <span class="co"># don't forget it's .by, not by!</span></span>
<span id="cb44-394"><a href="#cb44-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number)</span>
<span id="cb44-395"><a href="#cb44-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-396"><a href="#cb44-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-397"><a href="#cb44-397" aria-hidden="true" tabindex="-1"></a>Like when we first learned the summarise function above, we give our new column a name (<span class="in">`mean_weight_lost`</span>), and then we assign its value to be the mean of the <span class="in">`weight_lost_g`</span> column (with <span class="in">`NA`</span>s removed). But this time, we also added the <span class="in">`.by`</span> argument to specify the column we want to group by (<span class="in">`cage_number`</span>, in this case). This will return a data frame with the mean weight lost by mice in each cage.</span>
<span id="cb44-398"><a href="#cb44-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-399"><a href="#cb44-399" aria-hidden="true" tabindex="-1"></a>Grouping is a powerful tool for exploring your data and can help you identify patterns that might not be obvious when looking at the data as a whole. For example, notice how this grouped summary reveals that mice in cage 3E lost more weight than those in the other two cages.</span>
<span id="cb44-400"><a href="#cb44-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-401"><a href="#cb44-401" aria-hidden="true" tabindex="-1"></a>It's also possible to group by multiple columns by passing a vector of column names to the <span class="in">`.by`</span> argument. For example, to calculate the mean weight lost by mice in each cage and strain:</span>
<span id="cb44-402"><a href="#cb44-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-405"><a href="#cb44-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-406"><a href="#cb44-406" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-407"><a href="#cb44-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-408"><a href="#cb44-408" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group by both cage_number and mouse_strain</span></span>
<span id="cb44-409"><a href="#cb44-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(cage_number, mouse_strain))</span>
<span id="cb44-410"><a href="#cb44-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-411"><a href="#cb44-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-412"><a href="#cb44-412" aria-hidden="true" tabindex="-1"></a>Of course, <span class="in">`mean()`</span> is not the only function that we can use within <span class="in">`summarise()`</span>. We can use any function that takes a vector of values and returns a single value, like <span class="in">`median()`</span>, <span class="in">`sd()`</span>, or <span class="in">`max()`</span>. We can also use multiple functions at once, by giving each column a name and specifying the function we want to use. In the following code we first drop NA values from the <span class="in">`weight_lost_g`</span> column, to avoid repeating <span class="in">`na.rm = TRUE`</span>:</span>
<span id="cb44-413"><a href="#cb44-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-416"><a href="#cb44-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-417"><a href="#cb44-417" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-418"><a href="#cb44-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_lost_g) <span class="sc">%&gt;%</span> </span>
<span id="cb44-419"><a href="#cb44-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-420"><a href="#cb44-420" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb44-421"><a href="#cb44-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g),</span>
<span id="cb44-422"><a href="#cb44-422" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g),</span>
<span id="cb44-423"><a href="#cb44-423" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g),</span>
<span id="cb44-424"><a href="#cb44-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_weight_lost =</span> <span class="fu">max</span>(weight_lost_g),</span>
<span id="cb44-425"><a href="#cb44-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_weight_lost =</span> <span class="fu">min</span>(weight_lost_g),</span>
<span id="cb44-426"><a href="#cb44-426" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number)</span>
<span id="cb44-427"><a href="#cb44-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-428"><a href="#cb44-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-429"><a href="#cb44-429" aria-hidden="true" tabindex="-1"></a>Here, we also used the <span class="in">`n()`</span> function to calculate the number of mice in each cage. This is a special helper function that works within <span class="in">`summarise`</span> to count the number of rows in each group.</span>
<span id="cb44-430"><a href="#cb44-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-431"><a href="#cb44-431" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="To <span class="in">`.by`</span> or not to <span class="in">`.by`</span>?"}</span>
<span id="cb44-432"><a href="#cb44-432" aria-hidden="true" tabindex="-1"></a>In the <span class="in">`dplyr`</span> package, there are two ways to group data: using the <span class="in">`.by`</span> argument within various functions (as we have covered so far), or using the <span class="in">`group_by()`</span> function, then performing your operations and ungrouping with <span class="in">`ungroup()`</span>.</span>
<span id="cb44-433"><a href="#cb44-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-434"><a href="#cb44-434" aria-hidden="true" tabindex="-1"></a>For example, we've seen above how to calculate the mean weight lost by mice in each cage using the <span class="in">`.by`</span> argument:</span>
<span id="cb44-435"><a href="#cb44-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-438"><a href="#cb44-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-439"><a href="#cb44-439" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-440"><a href="#cb44-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> cage_number)</span>
<span id="cb44-441"><a href="#cb44-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-442"><a href="#cb44-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-443"><a href="#cb44-443" aria-hidden="true" tabindex="-1"></a>But we can also do the same using <span class="in">`group_by()`</span> and <span class="in">`ungroup()`</span>:</span>
<span id="cb44-446"><a href="#cb44-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-447"><a href="#cb44-447" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-448"><a href="#cb44-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cage_number) <span class="sc">%&gt;%</span></span>
<span id="cb44-449"><a href="#cb44-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-450"><a href="#cb44-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb44-451"><a href="#cb44-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-452"><a href="#cb44-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-453"><a href="#cb44-453" aria-hidden="true" tabindex="-1"></a>The two methods are equivalent, but using the <span class="in">`.by`</span> argument within functions can be more concise and easier to read. Still, it's good to be aware of <span class="in">`group_by()`</span> and <span class="in">`ungroup()`</span> as they are widely used, particularly in older code.</span>
<span id="cb44-454"><a href="#cb44-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-455"><a href="#cb44-455" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-456"><a href="#cb44-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-457"><a href="#cb44-457" aria-hidden="true" tabindex="-1"></a>Although grouping is most often used with <span class="in">`summarise()`</span>, it can be used with <span class="in">`dplyr`</span> functions too. For example mutate() function can also be used with grouping to add new columns to the data frame based on group-specific calculations. Let's say we wanted to calculate the Z-score (also known as the <span class="co">[</span><span class="ot">standard score</span><span class="co">](https://en.wikipedia.org/wiki/Standard_score)</span>) to standardise the weight lost by each mouse within each strain.</span>
<span id="cb44-458"><a href="#cb44-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-459"><a href="#cb44-459" aria-hidden="true" tabindex="-1"></a>As a reminder, the formula for calculating the Z-score is $\frac{x - \mu}{\sigma}$, where $x$ is the value (in our case the <span class="in">`weight_lost_g`</span> column), $\mu$ is the mean, and $\sigma$ is the standard deviation.</span>
<span id="cb44-460"><a href="#cb44-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-461"><a href="#cb44-461" aria-hidden="true" tabindex="-1"></a>We can calculate this for each mouse in each strain using the following code:</span>
<span id="cb44-462"><a href="#cb44-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-465"><a href="#cb44-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-466"><a href="#cb44-466" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-467"><a href="#cb44-467" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove NAs before calculating the mean and SD</span></span>
<span id="cb44-468"><a href="#cb44-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight_lost_g)) <span class="sc">%&gt;%</span></span>
<span id="cb44-469"><a href="#cb44-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_lost_z =</span> (weight_lost_g <span class="sc">-</span> <span class="fu">mean</span>(weight_lost_g)) <span class="sc">/</span> <span class="fu">sd</span>(weight_lost_g), <span class="at">.by =</span> mouse_strain) <span class="sc">%&gt;%</span></span>
<span id="cb44-470"><a href="#cb44-470" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select the relevant columns</span></span>
<span id="cb44-471"><a href="#cb44-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mouse_strain, weight_lost_g, weight_lost_z)</span>
<span id="cb44-472"><a href="#cb44-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-473"><a href="#cb44-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-474"><a href="#cb44-474" aria-hidden="true" tabindex="-1"></a>Unlike when we used <span class="in">`.by`</span> with <span class="in">`summarise()`</span>, we still get the same number of rows as the original data frame, but now we have a new column <span class="in">`weight_lost_z`</span> that contains the Z-score for each mouse within each strain. This could be useful for identifying outliers or comparing the weight lost by each mouse to the average for its strain.</span>
<span id="cb44-475"><a href="#cb44-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-476"><a href="#cb44-476" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="Practice exercises"}</span>
<span id="cb44-477"><a href="#cb44-477" aria-hidden="true" tabindex="-1"></a>Try these practice questions to test your understanding</span>
<span id="cb44-478"><a href="#cb44-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-479"><a href="#cb44-479" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-480"><a href="#cb44-480" aria-hidden="true" tabindex="-1"></a>1<span class="sc">\.</span> Which line of code would you use to calculate the median tail length of mice belonging to each strain in the <span class="in">`m_dose`</span> data frame?</span>
<span id="cb44-481"><a href="#cb44-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-482"><a href="#cb44-482" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-483"><a href="#cb44-483" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-484"><a href="#cb44-484" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm), .by = mouse_strain)`</span></span>
<span id="cb44-485"><a href="#cb44-485" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-486"><a href="#cb44-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-487"><a href="#cb44-487" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-488"><a href="#cb44-488" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm, na.rm = TRUE), .by = mouse_strain)`</span></span>
<span id="cb44-489"><a href="#cb44-489" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-490"><a href="#cb44-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-491"><a href="#cb44-491" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-492"><a href="#cb44-492" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm, na.rm = TRUE), by = mouse_strain)`</span></span>
<span id="cb44-493"><a href="#cb44-493" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-494"><a href="#cb44-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-495"><a href="#cb44-495" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-496"><a href="#cb44-496" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% mutate(median_tail_length = median(tail_length_mm, na.rm = TRUE), .by = mouse_strain)`</span></span>
<span id="cb44-497"><a href="#cb44-497" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-498"><a href="#cb44-498" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-499"><a href="#cb44-499" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-500"><a href="#cb44-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-501"><a href="#cb44-501" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-502"><a href="#cb44-502" aria-hidden="true" tabindex="-1"></a>2<span class="sc">\.</span> Explain in words what the following code does:</span>
<span id="cb44-503"><a href="#cb44-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-506"><a href="#cb44-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-507"><a href="#cb44-507" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-508"><a href="#cb44-508" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-509"><a href="#cb44-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_len =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(mouse_strain, replicate))</span>
<span id="cb44-510"><a href="#cb44-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-511"><a href="#cb44-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-512"><a href="#cb44-512" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-513"><a href="#cb44-513" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-514"><a href="#cb44-514" aria-hidden="true" tabindex="-1"></a>Calculates the maximum tail length of all mice for each strain in the <span class="in">`m_dose`</span> data frame</span>
<span id="cb44-515"><a href="#cb44-515" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-516"><a href="#cb44-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-517"><a href="#cb44-517" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-518"><a href="#cb44-518" aria-hidden="true" tabindex="-1"></a>Calculates the maximum tail length of all mice for each replicate in the <span class="in">`m_dose`</span> data frame</span>
<span id="cb44-519"><a href="#cb44-519" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-520"><a href="#cb44-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-521"><a href="#cb44-521" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-522"><a href="#cb44-522" aria-hidden="true" tabindex="-1"></a>Calculates the maximum tail length of all mice in the <span class="in">`m_dose`</span> data frame</span>
<span id="cb44-523"><a href="#cb44-523" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-524"><a href="#cb44-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-525"><a href="#cb44-525" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-526"><a href="#cb44-526" aria-hidden="true" tabindex="-1"></a>Calculates the maximum tail length of mice in each unique combination of strain and replicate in the <span class="in">`m_dose`</span> data frame.</span>
<span id="cb44-527"><a href="#cb44-527" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-528"><a href="#cb44-528" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-529"><a href="#cb44-529" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-530"><a href="#cb44-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-531"><a href="#cb44-531" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-532"><a href="#cb44-532" aria-hidden="true" tabindex="-1"></a>3<span class="sc">\.</span> I want to count how many male and how many female mice there are for each strain in the <span class="in">`m_dose`</span> data frame. Which line of code would I use?</span>
<span id="cb44-533"><a href="#cb44-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-534"><a href="#cb44-534" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-535"><a href="#cb44-535" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-536"><a href="#cb44-536" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(count = n(), .by = sex)`</span></span>
<span id="cb44-537"><a href="#cb44-537" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-538"><a href="#cb44-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-539"><a href="#cb44-539" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-540"><a href="#cb44-540" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(count = n(), .by = mouse_strain)`</span></span>
<span id="cb44-541"><a href="#cb44-541" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-542"><a href="#cb44-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-543"><a href="#cb44-543" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-544"><a href="#cb44-544" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(count = n(), .by = c(mouse_strain, sex))`</span></span>
<span id="cb44-545"><a href="#cb44-545" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-546"><a href="#cb44-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-547"><a href="#cb44-547" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-548"><a href="#cb44-548" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(count = n(), .by = mouse_strain, sex)`</span></span>
<span id="cb44-549"><a href="#cb44-549" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-550"><a href="#cb44-550" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-551"><a href="#cb44-551" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-552"><a href="#cb44-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-553"><a href="#cb44-553" aria-hidden="true" tabindex="-1"></a>::: question</span>
<span id="cb44-554"><a href="#cb44-554" aria-hidden="true" tabindex="-1"></a>4<span class="sc">\.</span> I want to find the proportion of weight lost **by each mouse** in each cage in the <span class="in">`m_dose`</span> data frame. Which line of code would I use?</span>
<span id="cb44-555"><a href="#cb44-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-556"><a href="#cb44-556" aria-hidden="true" tabindex="-1"></a>::: choices</span>
<span id="cb44-557"><a href="#cb44-557" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-558"><a href="#cb44-558" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% summarise(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE), .by = cage_number)`</span></span>
<span id="cb44-559"><a href="#cb44-559" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-560"><a href="#cb44-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-561"><a href="#cb44-561" aria-hidden="true" tabindex="-1"></a>::: {.choice .correct-choice}</span>
<span id="cb44-562"><a href="#cb44-562" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE), .by = cage_number)`</span></span>
<span id="cb44-563"><a href="#cb44-563" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-564"><a href="#cb44-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-565"><a href="#cb44-565" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-566"><a href="#cb44-566" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE, .by = cage_number))`</span></span>
<span id="cb44-567"><a href="#cb44-567" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-568"><a href="#cb44-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-569"><a href="#cb44-569" aria-hidden="true" tabindex="-1"></a>::: choice</span>
<span id="cb44-570"><a href="#cb44-570" aria-hidden="true" tabindex="-1"></a><span class="in">`m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE))`</span></span>
<span id="cb44-571"><a href="#cb44-571" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-572"><a href="#cb44-572" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-573"><a href="#cb44-573" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-574"><a href="#cb44-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-575"><a href="#cb44-575" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">details</span><span class="dt">&gt;</span></span>
<span id="cb44-576"><a href="#cb44-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-577"><a href="#cb44-577" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">summary</span><span class="dt">&gt;</span>Solutions<span class="dt">&lt;/</span><span class="kw">summary</span><span class="dt">&gt;</span></span>
<span id="cb44-578"><a href="#cb44-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-579"><a href="#cb44-579" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb44-580"><a href="#cb44-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-581"><a href="#cb44-581" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The correct line of code to calculate the median tail length of mice belonging to each strain in the <span class="in">`m_dose`</span> data frame is <span class="in">`m_dose %&gt;% summarise(median_tail_length = median(tail_length_mm, na.rm = TRUE), .by = mouse_strain)`</span>. Remember to use <span class="in">`na.rm = TRUE`</span> to remove any missing values before calculating the median, and to use <span class="in">`.by`</span> to specify the column to group by (not <span class="in">`by`</span>). Seeing as we want to calculate the median (collapse down to a single value per group), we need to use <span class="in">`summarise()`</span> rather than <span class="in">`mutate()`</span>.</span>
<span id="cb44-582"><a href="#cb44-582" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The code <span class="in">`m_dose %&gt;% summarise(max_tail_len = max(tail_length_mm, na.rm = TRUE), .by = c(mouse_strain, replicate))`</span> calculates the maximum tail length of mice in each **unique combination** of strain and replicate in the <span class="in">`m_dose`</span> data frame.</span>
<span id="cb44-583"><a href="#cb44-583" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The correct line of code to count how many male and how many female mice there are for each strain in the <span class="in">`m_dose`</span> data frame is <span class="in">`m_dose %&gt;% summarise(count = n(), .by = c(mouse_strain, sex))`</span>. We need to group by both <span class="in">`mouse_strain`</span> and <span class="in">`sex`</span> to get the count for each unique combination of strain and sex. Don't forget that we specify the column names as a vector when grouping by multiple columns.</span>
<span id="cb44-584"><a href="#cb44-584" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>The correct line of code to find the proportion of weight lost **by each mouse** in each cage in the <span class="in">`m_dose`</span> data frame is <span class="in">`m_dose %&gt;% mutate(weight_lost_proportion = weight_lost_g / sum(weight_lost_g, na.rm = TRUE), .by = cage_number)`</span>. We use <span class="in">`mutate()`</span> because we want a value for each mouse (each row in our data), rather than to collapse down to a single value for each group (cage number in this case). Be careful that you use the <span class="in">`.by`</span> argument within the <span class="in">`mutate()`</span> function call, not within the <span class="in">`sum()`</span> function by mistake (this is what is wrong with the third option).</span>
<span id="cb44-585"><a href="#cb44-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-586"><a href="#cb44-586" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb44-587"><a href="#cb44-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-588"><a href="#cb44-588" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">details</span><span class="dt">&gt;</span></span>
<span id="cb44-589"><a href="#cb44-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-590"><a href="#cb44-590" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-591"><a href="#cb44-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-592"><a href="#cb44-592" aria-hidden="true" tabindex="-1"></a><span class="fu">## Saving data to a file {#sec-saving}</span></span>
<span id="cb44-593"><a href="#cb44-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-594"><a href="#cb44-594" aria-hidden="true" tabindex="-1"></a>Once you've cleaned and transformed your data, you'll often want to save it to a file so that you can use it in other programs or share it with others. The <span class="in">`write_csv()`</span> and <span class="in">`write_tsv()`</span> functions from the <span class="in">`readr`</span> package are a great way to do this. They take two arguments - the data frame you want to save and the file path where you want to save it.</span>
<span id="cb44-595"><a href="#cb44-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-596"><a href="#cb44-596" aria-hidden="true" tabindex="-1"></a>For example, let's say I want to save my summary table of the weight lost by mice in each cage to a CSV file called <span class="in">`cage_summary_table.csv`</span>:</span>
<span id="cb44-597"><a href="#cb44-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-600"><a href="#cb44-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-601"><a href="#cb44-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-602"><a href="#cb44-602" aria-hidden="true" tabindex="-1"></a><span class="co"># create the summary table</span></span>
<span id="cb44-603"><a href="#cb44-603" aria-hidden="true" tabindex="-1"></a><span class="co"># and assign it to a variable</span></span>
<span id="cb44-604"><a href="#cb44-604" aria-hidden="true" tabindex="-1"></a>cage_summary_table <span class="ot">&lt;-</span> m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-605"><a href="#cb44-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-606"><a href="#cb44-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb44-607"><a href="#cb44-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-608"><a href="#cb44-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-609"><a href="#cb44-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-610"><a href="#cb44-610" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number)</span>
<span id="cb44-611"><a href="#cb44-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-612"><a href="#cb44-612" aria-hidden="true" tabindex="-1"></a><span class="co"># save the data to a CSV file</span></span>
<span id="cb44-613"><a href="#cb44-613" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(cage_summary_table, <span class="st">"cage_summary_table.csv"</span>)</span>
<span id="cb44-614"><a href="#cb44-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-615"><a href="#cb44-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-616"><a href="#cb44-616" aria-hidden="true" tabindex="-1"></a>CSV files are particularly great because they can be easily read into other software, like Excel.</span>
<span id="cb44-617"><a href="#cb44-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-618"><a href="#cb44-618" aria-hidden="true" tabindex="-1"></a>It's also possible to use the <span class="in">`write_*()`</span> functions along with a pipe:</span>
<span id="cb44-619"><a href="#cb44-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-622"><a href="#cb44-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-623"><a href="#cb44-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-624"><a href="#cb44-624" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-625"><a href="#cb44-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(weight_lost_g) <span class="sc">%&gt;%</span> </span>
<span id="cb44-626"><a href="#cb44-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-627"><a href="#cb44-627" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb44-628"><a href="#cb44-628" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_weight_lost =</span> <span class="fu">mean</span>(weight_lost_g),</span>
<span id="cb44-629"><a href="#cb44-629" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_weight_lost =</span> <span class="fu">median</span>(weight_lost_g),</span>
<span id="cb44-630"><a href="#cb44-630" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_weight_lost =</span> <span class="fu">sd</span>(weight_lost_g),</span>
<span id="cb44-631"><a href="#cb44-631" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> cage_number) <span class="sc">%&gt;%</span></span>
<span id="cb44-632"><a href="#cb44-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">"cage_summary_table.csv"</span>)</span>
<span id="cb44-633"><a href="#cb44-633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-634"><a href="#cb44-634" aria-hidden="true" tabindex="-1"></a>Remember here that the first argument (the data frame to save) is passed on by the pipe, so the only argument in the brackets is the second one: the file path.</span>
<span id="cb44-635"><a href="#cb44-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-636"><a href="#cb44-636" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb44-637"><a href="#cb44-637" aria-hidden="true" tabindex="-1"></a>Here's what we've covered in this chapter:</span>
<span id="cb44-638"><a href="#cb44-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-639"><a href="#cb44-639" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The basic dplyr verbs <span class="in">`mutate()`</span>, and <span class="in">`arrange()`</span> and how they can be used to tidy and analyse data.</span>
<span id="cb44-640"><a href="#cb44-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-641"><a href="#cb44-641" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The <span class="in">`summarise()`</span> function and how it can be used to calculate summary statistics on your data, as well as the power of grouping data with the <span class="in">`.by`</span> argument.</span>
<span id="cb44-642"><a href="#cb44-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-643"><a href="#cb44-643" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Why does data need to be tidy anyway?"}</span>
<span id="cb44-644"><a href="#cb44-644" aria-hidden="true" tabindex="-1"></a>In this chapter, we've been focusing on making our data 'tidy': that is, structured in a consistent way that makes it easy to work with. A nice visual illustration of tidy data and its importance can be <span class="co">[</span><span class="ot">found here</span><span class="co">](https://allisonhorst.com/other-r-fun)</span>.</span>
<span id="cb44-645"><a href="#cb44-645" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb44-646"><a href="#cb44-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-647"><a href="#cb44-647" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practice questions</span></span>
<span id="cb44-648"><a href="#cb44-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-649"><a href="#cb44-649" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>What would be the result of evaluating the following expressions? You don't need to know these off the top of your head, use R to help! (Hint: some expressions might give an error. Try to think about why)</span>
<span id="cb44-650"><a href="#cb44-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-651"><a href="#cb44-651" aria-hidden="true" tabindex="-1"></a>    a.  <span class="in">`m_dose %&gt;% mutate(weight_lost_kg = weight_lost_g / 1000)`</span></span>
<span id="cb44-652"><a href="#cb44-652" aria-hidden="true" tabindex="-1"></a>    b.  <span class="in">`m_dose %&gt;% summarise(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE))`</span></span>
<span id="cb44-653"><a href="#cb44-653" aria-hidden="true" tabindex="-1"></a>    c.  <span class="in">`m_dose %&gt;% summarise(mean_weight_lost = mean(weight_lost_g, na.rm = TRUE), .by = cage_number)`</span></span>
<span id="cb44-654"><a href="#cb44-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-655"><a href="#cb44-655" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>I want to add a new column to the <span class="in">`m_dose`</span> data frame that converts the <span class="in">`mouse_strain`</span> column to lowercase. Hint: you can use the <span class="in">`tolower()`</span> function in R to convert characters to lowercase. Look up its help page by typing <span class="in">`?tolower`</span> in the R console to see how to use it.</span>
<span id="cb44-656"><a href="#cb44-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-657"><a href="#cb44-657" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>How could you find the maximum tail length for each unique combination of sex and mouse strain in the <span class="in">`m_dose`</span> data frame?</span>
<span id="cb44-658"><a href="#cb44-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-659"><a href="#cb44-659" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Write a line of code to save the result of Q5 to a CSV file called <span class="in">`max_tail_length.csv`</span>.</span>
<span id="cb44-660"><a href="#cb44-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-661"><a href="#cb44-661" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">details</span><span class="dt">&gt;</span></span>
<span id="cb44-662"><a href="#cb44-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-663"><a href="#cb44-663" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">summary</span><span class="dt">&gt;</span>Solutions<span class="dt">&lt;/</span><span class="kw">summary</span><span class="dt">&gt;</span></span>
<span id="cb44-664"><a href="#cb44-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-665"><a href="#cb44-665" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>The result of evaluating the expressions would be:</span>
<span id="cb44-666"><a href="#cb44-666" aria-hidden="true" tabindex="-1"></a>    a. A data frame with an additional column <span class="in">`weight_lost_kg`</span> that contains the weight lost in kilograms.</span>
<span id="cb44-667"><a href="#cb44-667" aria-hidden="true" tabindex="-1"></a>    b. A data frame with the mean weight lost by all mice.</span>
<span id="cb44-668"><a href="#cb44-668" aria-hidden="true" tabindex="-1"></a>    c. A data frame with the mean weight lost by mice in each cage.</span>
<span id="cb44-669"><a href="#cb44-669" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>To add a new column to the <span class="in">`m_dose`</span> data frame that converts the <span class="in">`mouse_strain`</span> column to lowercase, you can use <span class="in">`mutate()`</span> as follows`:</span>
<span id="cb44-670"><a href="#cb44-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-673"><a href="#cb44-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-674"><a href="#cb44-674" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-675"><a href="#cb44-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mouse_strain_lower =</span> <span class="fu">tolower</span>(mouse_strain))</span>
<span id="cb44-676"><a href="#cb44-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-677"><a href="#cb44-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-678"><a href="#cb44-678" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>You can use the <span class="in">`max()`</span> function within <span class="in">`summarise(.by = c(sex, mouse_strain))`</span> to find the maximum tail length of each unique sex/mouse strain combination:</span>
<span id="cb44-679"><a href="#cb44-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-682"><a href="#cb44-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-683"><a href="#cb44-683" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-684"><a href="#cb44-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_length =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(sex, mouse_strain))</span>
<span id="cb44-685"><a href="#cb44-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-686"><a href="#cb44-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-687"><a href="#cb44-687" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>To save the result of Q5 to a CSV file called <span class="in">`max_tail_length.csv`</span>, you can use the <span class="in">`write_csv()`</span> function, either by using a pipe to connect it to the code you wrote previously:</span>
<span id="cb44-690"><a href="#cb44-690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-691"><a href="#cb44-691" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-692"><a href="#cb44-692" aria-hidden="true" tabindex="-1"></a>m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-693"><a href="#cb44-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_length =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(sex, mouse_strain)) <span class="sc">%&gt;%</span></span>
<span id="cb44-694"><a href="#cb44-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">"max_tail_length.csv"</span>)</span>
<span id="cb44-695"><a href="#cb44-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-696"><a href="#cb44-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-697"><a href="#cb44-697" aria-hidden="true" tabindex="-1"></a>Or by assigning this result to a variable and then saving it to a file:</span>
<span id="cb44-700"><a href="#cb44-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-701"><a href="#cb44-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb44-702"><a href="#cb44-702" aria-hidden="true" tabindex="-1"></a>max_tail_length <span class="ot">&lt;-</span> m_dose <span class="sc">%&gt;%</span></span>
<span id="cb44-703"><a href="#cb44-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max_tail_length =</span> <span class="fu">max</span>(tail_length_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> <span class="fu">c</span>(sex, mouse_strain))</span>
<span id="cb44-704"><a href="#cb44-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-705"><a href="#cb44-705" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(max_tail_length, <span class="st">"max_tail_length.csv"</span>)</span>
<span id="cb44-706"><a href="#cb44-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-707"><a href="#cb44-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-708"><a href="#cb44-708" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">details</span><span class="dt">&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="site_libs/quarto-contrib/alpine-3.12/alpine@3.12.min.js"></script>
</body></html>